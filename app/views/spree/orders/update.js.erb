// Refresh minicart count
$("#link-to-cart").html('<%= escape_javascript render("spree/shared/cart") %>')

// Refresh minicart line items and update coupon_code
var coupon_form = $('#update-coupon');
var coupon_status = $("<div id='coupon_status'></div>");
coupon_form.append(coupon_status);

<% if ( flash[:error].blank? ) %>
	$("#content_dynamic_cart").html('<%= escape_javascript render("spree/shared/minicart_content") %>');
	<% if !current_order.coupon_code.blank? %>
		coupon_form = $('#update-coupon');
	    coupon_status = $("<div id='coupon_status'></div>");    
		coupon_form.append(coupon_status);
		$('#coupon_status').addClass('coupon_success').html('<%= flash[:success] %>');
	<% end %>
<% else %>
    $('#coupon_status').html('<%= flash[:error] %>');
<% end %>

$("#progress").slideUp();
$('#coupon_status').css({"visibility": "visible"});
$('#coupon_loading').css({"display": "none", "visibility": "hidden"});
$('#update-button').css({"visibility": "visible"});
$('#order_coupon_code').val('').focus();

setTimeout(function () {
    $('#coupon_status').css({"visibility": "hidden"});
}, 4000);